<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AFK Page - Aurlets</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

  <!-- Container -->
  <div id="afk-container" class="hidden text-center space-y-6">
    <h1 class="text-3xl font-bold">üí§ AFK Farming</h1>

    <!-- User info -->
    <div class="flex flex-col items-center space-y-2">
      <img id="user-avatar" class="w-16 h-16 rounded-full border-2 border-blue-400" />
      <p id="user-name" class="text-lg font-semibold"></p>
    </div>

    <!-- Points & Timer -->
    <div class="space-y-2">
      <p class="text-xl">Your Ayra Points: <span id="points" class="font-bold text-green-400">0</span></p>
      <p class="text-sm">‚è≥ Next point in <span id="countdown" class="font-bold">60</span> seconds</p>
    </div>

    <!-- Ad placeholder -->
    <div class="mt-6 p-4 bg-gray-800 rounded-lg shadow-lg">
      <p class="text-gray-400">[Ad Space - Place your AdSense / other ad code here]</p>
    </div>
  </div>

  <!-- Script -->
  <script>
    async function checkLogin() {
      try {
        const res = await fetch("/api/me");
        if (!res.ok) {
          window.location.href = "/";
          return;
        }

        const user = await res.json();
        document.getElementById("afk-container").classList.remove("hidden");

        document.getElementById("user-avatar").src =
          `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
        document.getElementById("user-name").innerText =
          `${user.username}#${user.discriminator}`;

        // Load initial points
        const pointsRes = await fetch("/api/points");
        const data = await pointsRes.json();
        document.getElementById("points").innerText = data.points || 0;

      } catch (err) {
        console.error("Login check failed:", err);
        window.location.href = "/";
      }
    }

    let countdown = 60;

    function startAFK() {
      setInterval(async () => {
        if (countdown <= 1) {
          try {
            const res = await fetch("/api/points", { method: "POST" });
            const data = await res.json();
            document.getElementById("points").innerText = data.points;
          } catch (err) {
            console.error("Error updating points:", err);
          }
          countdown = 60;
        } else {
          countdown--;
        }
        document.getElementById("countdown").innerText = countdown;
      }, 1000);
    }

    checkLogin().then(startAFK);
  </script>
</body>
</html>
